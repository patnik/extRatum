<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Built Environment example • extRatum</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Built Environment example">
<meta property="og:description" content="extRatum">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">extRatum</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Example_cities.html">Built Environment example</a>
    </li>
    <li>
      <a href="../articles/Example_lakes.html">Natural Environment example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Example_cities_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Built Environment example</h1>
                        <h4 class="author">Nikos Patias</h4>
            
            <h4 class="date">21/01/2021</h4>
      
      
      <div class="hidden name"><code>Example_cities.Rmd</code></div>

    </div>

    
    
<div id="built-environment-statistical-indicators" class="section level1">
<h1 class="hasAnchor">
<a href="#built-environment-statistical-indicators" class="anchor"></a>Built environment statistical indicators</h1>
<p>This notebook demonstrates the use of <code>extRatum</code> package drawing on <em>OpenStreetMap</em> data. <code>extRatum</code> provides summary statistics of local geospatial features within a given geographic area. It does so by calculating the area covered by a target geospatial feature (i.e. buildings, parks, lakes, etc.). The geospatial features can be of any geospatial data type, including point, polygon or line data.</p>
<p>In this example, we focus on built environment characteristics.</p>
<p>We make use of OpenStreetMap data and calculate point-, polygon- and line-based data features. The reference layer is the Lower Layer Super Output Area (LSOA) boundaries for the city of Liverpool in the United Kingdom.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">extRatum</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: package 'sf' was built under R version 4.0.3</code></pre>
<pre><code>## Linking to GEOS 3.8.0, GDAL 3.0.4, PROJ 6.3.1</code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Attaching package: 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/osmdata">osmdata</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Data (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright</code></pre>
<div id="read-boundaries" class="section level2">
<h2 class="hasAnchor">
<a href="#read-boundaries" class="anchor"></a>Read boundaries</h2>
<p>First, we read in the LSOA boundaries for Liverpool. The data downloaded from CDRC website: <a href="https://data.cdrc.ac.uk/" class="uri">https://data.cdrc.ac.uk/</a></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># 1. Read in the FUA grids</span>
<span class="va">LSOAs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html">st_read</a></span><span class="op">(</span><span class="st">"layers/E08000012.shp"</span><span class="op">)</span></code></pre></div>
<pre><code>## Reading layer `E08000012' from data source `C:\Users\User\Desktop\extRatum\vignettes\layers\E08000012.shp' using driver `ESRI Shapefile'
## Simple feature collection with 298 features and 1 field
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: 333086.1 ymin: 381426.3 xmax: 345636 ymax: 397980.1
## projected CRS:  Transverse_Mercator</code></pre>
<p>Because the area of interest is in the UK, we select the British National Grid as a planar coordinate system of reference.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">BNG</span> <span class="op">=</span> <span class="st">"epsg:27700"</span></code></pre></div>
</div>
<div id="point-data-metrics" class="section level2">
<h2 class="hasAnchor">
<a href="#point-data-metrics" class="anchor"></a>Point data metrics</h2>
<p>Here, we illustrate the use of <code>extRatum</code> with point data.</p>
<p>We create a simple query to download point data representing shops in Liverpool.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html">getbb</a></span><span class="op">(</span><span class="st">"Liverpool"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html">opq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"shop"</span><span class="op">)</span>

<span class="va">shops</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q</span><span class="op">)</span></code></pre></div>
<p>And plot them.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#tmap_mode("view") #use this code for creating an interactive map</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tmap_mode.html">tmap_mode</a></span><span class="op">(</span><span class="st">"plot"</span><span class="op">)</span></code></pre></div>
<pre><code>## tmap mode set to plotting</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># show the points and grids</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">LSOAs</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">shops</span><span class="op">$</span><span class="va">osm_points</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_symbols.html">tm_dots</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="Example_cities_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>Then we calculate the number of points in each polygon using the <code><a href="../reference/point_calc.html">point_calc()</a></code> function. Note that we have to pass a planar coordinate system in all our functions. Here we are using the British National Grid. The output of this function will be a dataframe containing:</p>
<ul>
<li>LSOA code;</li>
<li>total area in sqm of each LSOA;</li>
<li>number of points (i.e. shops) in each LSOA; and</li>
<li>ratio of points to the total LSOA area (or in other words the number of points by sqm). In this way, we have a relative measure that can be compared across all LSOAs and is independent of their geographical area.</li>
</ul>
<p>Note that we have used the argument <code>total_points = TRUE</code> which returns the total number of points without differentiating between different shop types.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Shops_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point_calc.html">point_calc</a></span><span class="op">(</span>
  point_data <span class="op">=</span> <span class="va">shops</span><span class="op">$</span><span class="va">osm_points</span>,
  higher_geo_lay <span class="op">=</span> <span class="va">LSOAs</span>,
  unique_id_code <span class="op">=</span> <span class="st">'lsoa11cd'</span>,
  crs <span class="op">=</span> <span class="va">BNG</span>,
  total_points <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># inspect the results</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Shops_total</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   lsoa11cd  TotalArea NoPoints      Ratio
##   &lt;chr&gt;         &lt;dbl&gt;    &lt;int&gt;      &lt;dbl&gt;
## 1 E01006513   555037.       29 0.0000522 
## 2 E01006514   262031.        2 0.00000763
## 3 E01006515   366500.       16 0.0000437 
## 4 E01006518   235181.        1 0.00000425
## 5 E01006520   259435.        1 0.00000385
## 6 E01006522   473782.        3 0.00000633</code></pre>
<p>In some cases, we want to know the split between different types of points. To that end, we can change the <code>total_points = FALSE</code> and specify the column name that includes the classification (see <code>class_col</code>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Shops_class</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/point_calc.html">point_calc</a></span><span class="op">(</span>
  point_data <span class="op">=</span> <span class="va">shops</span><span class="op">$</span><span class="va">osm_points</span>,
  higher_geo_lay <span class="op">=</span> <span class="va">LSOAs</span>,
  unique_id_code <span class="op">=</span> <span class="st">'lsoa11cd'</span>,
  class_col <span class="op">=</span> <span class="st">'shop'</span>,
  crs <span class="op">=</span> <span class="va">BNG</span>,
  total_points <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span></code></pre></div>
<p>The output of this function will be a list of three dataframes.</p>
<ol style="list-style-type: decimal">
<li>A dataframe in long format reporting:</li>
</ol>
<ul>
<li>LSOA codes;</li>
<li>total area in sqm of each LSOA;</li>
<li>classification of the points within each LSOA;</li>
<li>number of points in each class (i.e. bakery, beauty) in each LSOA; and</li>
<li>ratio of points in each class to the total LSOA area (or in other words the number of points by sqm).</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Shops_class</span><span class="op">$</span><span class="va">PointsLong</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   lsoa11cd  TotalArea shop        NoPoints      Ratio
##   &lt;chr&gt;         &lt;dbl&gt; &lt;chr&gt;          &lt;int&gt;      &lt;dbl&gt;
## 1 E01006513   555037. bakery             2 0.00000360
## 2 E01006513   555037. beauty             1 0.00000180
## 3 E01006513   555037. bookmaker          2 0.00000360
## 4 E01006513   555037. books              2 0.00000360
## 5 E01006513   555037. clothes            1 0.00000180
## 6 E01006513   555037. convenience        8 0.0000144</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>A dataframe in wide format reporting:</li>
</ol>
<ul>
<li>LSOA codes;</li>
<li>number of points in each class (i.e. bakery, beauty) in each LSOA.</li>
</ul>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Shops_class</span><span class="op">$</span><span class="va">PointsCountWide</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 92
##   lsoa11cd alcohol  Baby baby_goods   bag bakery beauty   bed beverages bicycle
##   &lt;chr&gt;      &lt;int&gt; &lt;int&gt;      &lt;int&gt; &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;int&gt;     &lt;int&gt;   &lt;int&gt;
## 1 E010065~      NA    NA         NA    NA      2      1    NA        NA      NA
## 2 E010065~      NA    NA         NA    NA     NA     NA    NA        NA      NA
## 3 E010065~      NA    NA         NA    NA     NA     NA    NA        NA       1
## 4 E010065~      NA    NA         NA    NA     NA     NA    NA        NA      NA
## 5 E010065~      NA    NA         NA    NA     NA     NA    NA        NA      NA
## 6 E010065~      NA    NA         NA    NA     NA     NA    NA        NA      NA
## # ... with 82 more variables: bookmaker &lt;int&gt;, books &lt;int&gt;, `Business
## #   Service` &lt;int&gt;, butcher &lt;int&gt;, cakes &lt;int&gt;, car &lt;int&gt;, car_parts &lt;int&gt;,
## #   car_repair &lt;int&gt;, carpet &lt;int&gt;, catalogue &lt;int&gt;, charity &lt;int&gt;,
## #   chemist &lt;int&gt;, clothes &lt;int&gt;, coffee &lt;int&gt;, computer &lt;int&gt;,
## #   confectionery &lt;int&gt;, convenience &lt;int&gt;, cosmetics &lt;int&gt;, craft &lt;int&gt;,
## #   deli &lt;int&gt;, department_store &lt;int&gt;, Discount &lt;int&gt;, doityourself &lt;int&gt;,
## #   dry_cleaning &lt;int&gt;, electrical &lt;int&gt;, electronics &lt;int&gt;, erotic &lt;int&gt;,
## #   estate_agent &lt;int&gt;, florist &lt;int&gt;, food &lt;int&gt;, frozen_food &lt;int&gt;,
## #   funeral_directors &lt;int&gt;, furniture &lt;int&gt;, games &lt;int&gt;, garden_centre &lt;int&gt;,
## #   gift &lt;int&gt;, greeting_card &lt;int&gt;, `greetings cards` &lt;int&gt;,
## #   hairdresser &lt;int&gt;, hardware &lt;int&gt;, health_food &lt;int&gt;, hifi &lt;int&gt;,
## #   houseware &lt;int&gt;, jewelry &lt;int&gt;, kiosk &lt;int&gt;, laundry &lt;int&gt;, leather &lt;int&gt;,
## #   mall &lt;int&gt;, mobile_phone &lt;int&gt;, music &lt;int&gt;, musical_instrument &lt;int&gt;,
## #   newsagent &lt;int&gt;, optician &lt;int&gt;, outdoor &lt;int&gt;, pawnbroker &lt;int&gt;,
## #   perfumery &lt;int&gt;, pet &lt;int&gt;, photo &lt;int&gt;, religion &lt;int&gt;, salon &lt;int&gt;,
## #   second_hand &lt;int&gt;, shoes &lt;int&gt;, sports &lt;int&gt;, stationery &lt;int&gt;,
## #   storage_rental &lt;int&gt;, supermarket &lt;int&gt;, tailor &lt;int&gt;, tea &lt;int&gt;,
## #   ticket &lt;int&gt;, `ticket;convenience` &lt;int&gt;, toys &lt;int&gt;, trade &lt;int&gt;,
## #   travel_agency &lt;int&gt;, vacant &lt;int&gt;, variety_store &lt;int&gt;, video_games &lt;int&gt;,
## #   Vintage_Boutique &lt;int&gt;, watches &lt;int&gt;, window_blind &lt;int&gt;, wine &lt;int&gt;,
## #   yes &lt;int&gt;, `&lt;NA&gt;` &lt;int&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>A dataframe in wide format reporting:</li>
</ol>
<ul>
<li>LSOA codes;</li>
<li>ratio of points in each class to the total LSOA area (or in other words the number of points by sqm).</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Shops_class</span><span class="op">$</span><span class="va">PointsRatioWide</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 92
##   lsoa11cd alcohol  Baby baby_goods   bag   bakery   beauty   bed beverages
##   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
## 1 E010065~      NA    NA         NA    NA  3.60e-6  1.80e-6    NA        NA
## 2 E010065~      NA    NA         NA    NA NA       NA          NA        NA
## 3 E010065~      NA    NA         NA    NA NA       NA          NA        NA
## 4 E010065~      NA    NA         NA    NA NA       NA          NA        NA
## 5 E010065~      NA    NA         NA    NA NA       NA          NA        NA
## 6 E010065~      NA    NA         NA    NA NA       NA          NA        NA
## # ... with 83 more variables: bicycle &lt;dbl&gt;, bookmaker &lt;dbl&gt;, books &lt;dbl&gt;,
## #   `Business Service` &lt;dbl&gt;, butcher &lt;dbl&gt;, cakes &lt;dbl&gt;, car &lt;dbl&gt;,
## #   car_parts &lt;dbl&gt;, car_repair &lt;dbl&gt;, carpet &lt;dbl&gt;, catalogue &lt;dbl&gt;,
## #   charity &lt;dbl&gt;, chemist &lt;dbl&gt;, clothes &lt;dbl&gt;, coffee &lt;dbl&gt;, computer &lt;dbl&gt;,
## #   confectionery &lt;dbl&gt;, convenience &lt;dbl&gt;, cosmetics &lt;dbl&gt;, craft &lt;dbl&gt;,
## #   deli &lt;dbl&gt;, department_store &lt;dbl&gt;, Discount &lt;dbl&gt;, doityourself &lt;dbl&gt;,
## #   dry_cleaning &lt;dbl&gt;, electrical &lt;dbl&gt;, electronics &lt;dbl&gt;, erotic &lt;dbl&gt;,
## #   estate_agent &lt;dbl&gt;, florist &lt;dbl&gt;, food &lt;dbl&gt;, frozen_food &lt;dbl&gt;,
## #   funeral_directors &lt;dbl&gt;, furniture &lt;dbl&gt;, games &lt;dbl&gt;, garden_centre &lt;dbl&gt;,
## #   gift &lt;dbl&gt;, greeting_card &lt;dbl&gt;, `greetings cards` &lt;dbl&gt;,
## #   hairdresser &lt;dbl&gt;, hardware &lt;dbl&gt;, health_food &lt;dbl&gt;, hifi &lt;dbl&gt;,
## #   houseware &lt;dbl&gt;, jewelry &lt;dbl&gt;, kiosk &lt;dbl&gt;, laundry &lt;dbl&gt;, leather &lt;dbl&gt;,
## #   mall &lt;dbl&gt;, mobile_phone &lt;dbl&gt;, music &lt;dbl&gt;, musical_instrument &lt;dbl&gt;,
## #   newsagent &lt;dbl&gt;, optician &lt;dbl&gt;, outdoor &lt;dbl&gt;, pawnbroker &lt;dbl&gt;,
## #   perfumery &lt;dbl&gt;, pet &lt;dbl&gt;, photo &lt;dbl&gt;, religion &lt;dbl&gt;, salon &lt;dbl&gt;,
## #   second_hand &lt;dbl&gt;, shoes &lt;dbl&gt;, sports &lt;dbl&gt;, stationery &lt;dbl&gt;,
## #   storage_rental &lt;dbl&gt;, supermarket &lt;dbl&gt;, tailor &lt;dbl&gt;, tea &lt;dbl&gt;,
## #   ticket &lt;dbl&gt;, `ticket;convenience` &lt;dbl&gt;, toys &lt;dbl&gt;, trade &lt;dbl&gt;,
## #   travel_agency &lt;dbl&gt;, vacant &lt;dbl&gt;, variety_store &lt;dbl&gt;, video_games &lt;dbl&gt;,
## #   Vintage_Boutique &lt;dbl&gt;, watches &lt;dbl&gt;, window_blind &lt;dbl&gt;, wine &lt;dbl&gt;,
## #   yes &lt;dbl&gt;, `&lt;NA&gt;` &lt;dbl&gt;</code></pre>
<p>Finally we can map the results to show the density of shops in the city of Liverpool at the LSOA level.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># attach the information calculate using extRatum to the LSOA boundaries</span>
<span class="va">Liv_shops_geo</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">LSOAs</span>, <span class="va">Shops_total</span>, by <span class="op">=</span> <span class="st">"lsoa11cd"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Liv_shops_geo</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">"NoPoints"</span>, style <span class="op">=</span> <span class="st">"fisher"</span>, palette <span class="op">=</span> <span class="st">"Reds"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></code></pre></div>
<p><img src="Example_cities_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div id="polygon-data-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#polygon-data-analysis" class="anchor"></a>Polygon data analysis</h2>
<p>Next, we illustrate the use of <code>extRatum</code> with polygon data.</p>
<p>We create a query to download building footprints for the city of Liverpool using <em>OpenStreetMap</em> data.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html">getbb</a></span><span class="op">(</span><span class="st">"Liverpool"</span>, limit <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html">opq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"building"</span><span class="op">)</span>

<span class="va">buildings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q2</span><span class="op">)</span></code></pre></div>
<p>We can then subset the buildings that are classified as retail.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">retail_buildings</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">buildings</span><span class="op">$</span><span class="va">osm_polygons</span>, <span class="va">building</span><span class="op">==</span><span class="st">"retail"</span><span class="op">)</span></code></pre></div>
<p>Then, we run the function that calculates the area in sqm covered by retail buildings in each LSOA using <code><a href="../reference/areal_calc.html">areal_calc()</a></code> function.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Liv_retail</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/areal_calc.html">areal_calc</a></span><span class="op">(</span>
  polygon_layer <span class="op">=</span> <span class="va">retail_buildings</span>,
  higher_geo_lay <span class="op">=</span> <span class="va">LSOAs</span>,
  unique_id_code <span class="op">=</span> <span class="st">'lsoa11cd'</span>,
  crs <span class="op">=</span> <span class="va">BNG</span>
  <span class="op">)</span></code></pre></div>
<p>The output of this function will be a dataframe containing:</p>
<ul>
<li>LSOA codes;</li>
<li>total area in sqm of each LSOA;</li>
<li>area in sqm covered by the geospatial feature we have selected in each LSOA; and</li>
<li>ratio of geospatial feature area to the total LSOA area (or in other words the area covered by the geospatial feature by sqm).</li>
</ul>
<p>Given that everything is measured in sqm, the ratio represents what is the % of area covered by retail buildings by sqm. In this way, we have a relative measure that can be compared across all LSOAs and is independent of their size.</p>
<p>We can also transform the calculated values in sqkm by dividing the value in sqm by 1,000,000. This can be done as follows.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Liv_retail</span><span class="op">$</span><span class="va">AreaCovered_sqkm</span> <span class="op">&lt;-</span> <span class="va">Liv_retail</span><span class="op">$</span><span class="va">AreaCovered</span> <span class="op">/</span><span class="fl">1000000</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Liv_retail</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   lsoa11cd  TotalArea AreaCovered     Ratio AreaCovered_sqkm
##   &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;            &lt;dbl&gt;
## 1 E01006519   505501.      946.   0.00187         0.000946  
## 2 E01006537  1077345.     5864.   0.00544         0.00586   
## 3 E01006563   287328.     1455.   0.00506         0.00145   
## 4 E01006570   443140.        7.59 0.0000171       0.00000759
## 5 E01006571   404631.      830.   0.00205         0.000830  
## 6 E01006572   135551.      110.   0.000813        0.000110</code></pre>
<p>Finally, we can plot the results, showing the total area covered by retail buildings in each LSOA in Liverpool. Note that OSM data on retail buildings are not complete for the city of Liverpool. Thus, we see too many LSOAs with missing data.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Liv_retail_geo</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">LSOAs</span>, <span class="va">Liv_retail</span>, by <span class="op">=</span> <span class="st">"lsoa11cd"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Liv_retail_geo</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">"AreaCovered"</span>, style <span class="op">=</span> <span class="st">"fisher"</span>, palette <span class="op">=</span> <span class="st">"Reds"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span> </code></pre></div>
<p><img src="Example_cities_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div id="line-data-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#line-data-analysis" class="anchor"></a>Line data analysis</h2>
<p>Now, we illustrate the use of <code>extRatum</code> with line data.</p>
<p>We create a query to download highway lines for the city of Liverpool using OpenStreetMap data.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">q3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/getbb.html">getbb</a></span><span class="op">(</span><span class="st">"Liverpool"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/opq.html">opq</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/add_osm_feature.html">add_osm_feature</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"highway"</span><span class="op">)</span>

<span class="va">highways</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/osmdata/reference/osmdata_sf.html">osmdata_sf</a></span><span class="op">(</span><span class="va">q3</span><span class="op">)</span></code></pre></div>
<p>We can then create subsets of the dataset such as pathways for pedestrian use.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pedestrian</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">highways</span><span class="op">$</span><span class="va">osm_lines</span>, <span class="va">highway</span> <span class="op">==</span> <span class="st">"pedestrian"</span><span class="op">)</span></code></pre></div>
<p>Then we can calculate the total length of pedestrian pathways routes by LSOA using <code><a href="../reference/line_calc.html">line_calc()</a></code> function.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Liv_footways</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/line_calc.html">line_calc</a></span><span class="op">(</span>
  line_layer <span class="op">=</span> <span class="va">pedestrian</span>,
  higher_geo_lay <span class="op">=</span> <span class="va">LSOAs</span>,
  unique_id_code <span class="op">=</span> <span class="st">'lsoa11cd'</span>,
  crs <span class="op">=</span> <span class="va">BNG</span>
  <span class="op">)</span></code></pre></div>
<p>The output of this function will be a dataframe containing:</p>
<ul>
<li>LSOA codes;</li>
<li>total area in sqm of each LSOA;</li>
<li>total line length in metres by the geospatial feature we have selected in each LSOA; and</li>
<li>ratio of geospatial feature length to the total LSOA area (or in other words the length of the geospatial feature by sqm). In this way, we have a relative measure that can be compared across all LSOAs and is independent of their size.</li>
</ul>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">Liv_footways</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   lsoa11cd  TotalArea TotalLength     Ratio
##   &lt;chr&gt;         &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1 E01006512   283907.       22.7  0.0000799
## 2 E01006513   555037.      208.   0.000375 
## 3 E01006514   262031.        9.73 0.0000371
## 4 E01006515   366500.       38.3  0.000104 
## 5 E01006518   235181.       29.5  0.000125 
## 6 E01006521   603082.       29.2  0.0000484</code></pre>
<p>Finally, we can plot the results, showing the total length of pedestrian pathways in each LSOA in Liverpool. Note that the majority is around Liverpool city centre where we see darker colours.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Liv_footways_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">LSOAs</span>, <span class="va">Liv_footways</span>, by <span class="op">=</span> <span class="st">"lsoa11cd"</span><span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">Liv_footways_geo</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_fill</a></span><span class="op">(</span><span class="st">"TotalLength"</span>, style <span class="op">=</span> <span class="st">"fisher"</span>, palette <span class="op">=</span> <span class="st">"Reds"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span></code></pre></div>
<p><img src="Example_cities_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nikos Patias, Francisco Rowe.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
